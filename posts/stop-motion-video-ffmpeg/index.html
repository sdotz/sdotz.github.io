<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Stephen Dotz"><meta name=description content="Stephen Dotz's website"><meta name=keywords content=blog,developer,personal><base href=https://stephendotz.com/><title>Stop-Motion Videos Using FFmpeg · Stephen Dotz</title><link rel=canonical href=https://stephendotz.com/posts/stop-motion-video-ffmpeg/><link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.3.1/css/all.css integrity=sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin=anonymous><link rel=stylesheet href=https://stephendotz.com/css/coder.min.1e2366334cf7de95544114e2ae4c7ccd362cf212bd1b287f7a92d1f974ec4f07.css integrity="sha256-HiNmM0z33pVUQRTirkx8zTYs8hK9Gyh/epLR&#43;XTsTwc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://stephendotz.com/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://stephendotz.com/images/favicon-16x16.png sizes=16x16><link rel=stylesheet href=//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack-subset.css><meta name=generator content="Hugo 0.58.3"></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://stephendotz.com/>Stephen Dotz</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fas fa-bars"></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://stephendotz.com/posts/>Blog</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Stop-Motion Videos Using FFmpeg</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fas fa-calendar"></i><time datetime=2020-01-03T12:00:00-05:00>January 3, 2020</time></span>
<span class=reading-time><i class="fas fa-clock"></i>4 minutes read</span></div></div></header><div><p>Winter is here and my morning project was to swap a set of bindings from my old snowboard to my new one. I decided I would try to make a fun stop motion video of the process.</p><div style=position:relative;padding-bottom:56.25%><iframe src=https://gfycat.com/ifr/kindlybackanemonecrab frameborder=0 scrolling=no width=100% height=100% style=position:absolute;top:0;left:0 allowfullscreen></iframe></div><p>I set the scene up with my iPhone 11 Pro above in portrait orientation and began snapping a picture at every step. I ended with a 52 photo series. The remaining work was to stitch the photos together in a video.</p><p>My first attempt was iMovie on iOS. It added a Ken Burns effect to every photo, and a dissolve transition between them. After I painstakingly removed the 104 effects and transitions, I could not find a way to orient the video in portrait to match the photos. iMovie is a little too &ldquo;on rails&rdquo; for this.</p><p>I went scouring the App Store for stop motion video tools. It was a sea shoddy freemium apps, and only a few would import from the camera roll. Most required in-app-purchases to enable basic functionality, or to remove their watermark. I tried 7 different apps before remembering <a href=https://github.com/FFmpeg/FFmpeg>FFmpeg</a>, which I had once used for a time-lapse of an ant farm.</p><p>For those of you who have not used FFmpeg, it is a total Swiss-army knife for video encoding. It’s quite a popular piece of open source software, and has probably been used by every major media or video-anything company at some point. Most often it is used as a command line tool, which can be a bit intimidating. I’ll show you how to combine frames into video with just a few carefully chosen lines of bash.</p><p>First, I Airdropped the photos from my iPhone to my Mac and stuck them in a directory.</p><p>I shot the photos with the phone on a DJI Osmo 3 Gimbal and the app produced some pretty gruesome filenames:</p><p><code>DJI_20200102_100938_408.JPG</code></p><p>Fortunately they were increasing, so listing them in order was automatic. We could also list them in date order with <code>ls -rA1</code> and then rename the files with a sequence. I didn&rsquo;t need to do this, but in case you do:</p><div class=highlight><pre style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#fff;font-weight:700>for</span> i in <span style=color:#fff;font-weight:700>$(</span>ls -rA1<span style=color:#fff;font-weight:700>)</span>; <span style=color:#fff;font-weight:700>do</span>
  new=<span style=color:#fff;font-weight:700>$(</span><span style=color:#fff;font-weight:700>printf</span> <span style=color:#0ff;font-weight:700>&#34;%04d.jpg&#34;</span> <span style=color:#0ff;font-weight:700>&#34;</span>$a<span style=color:#0ff;font-weight:700>&#34;</span><span style=color:#fff;font-weight:700>)</span> <span style=color:#007f7f>#04 pad to length of 4</span>
  mv -i -- <span style=color:#0ff;font-weight:700>&#34;</span>$i<span style=color:#0ff;font-weight:700>&#34;</span> <span style=color:#0ff;font-weight:700>&#34;</span>$new<span style=color:#0ff;font-weight:700>&#34;</span>
  <span style=color:#fff;font-weight:700>let</span> a=a+1
<span style=color:#fff;font-weight:700>done</span></code></pre></div><p>&hellip;will get you 0001.jpg, 0002.jpg, …</p><p>Next I ran FFmpeg on the files in the directory. I experimented for a good half hour to get this right but I will try to break down the flags:</p><p><code>ffmpeg -f image2 -r 8 -pattern_type glob -i &quot;*.jpg&quot; -aspect 3024:4032 -vf &quot;transpose=1&quot; -r 30 -vcodec libx264 -profile:v main -level 3.1 -preset medium -crf 23 -x264-params ref=4 -acodec copy -movflags +faststart &quot;out3.mov&quot;</code></p><p><code>-r 8</code> The frame rate of input. I found after some experimentation that 8FPS looked good. It depends how many frames you shoot and how much motion occurs between frames. It also affects the length of the output video.</p><p>If your files list in order already:
<code>-pattern_type glob -i &quot;*.jpg&quot;</code></p><p>-OR-</p><p>If you renamed your files with a sequence number:
<code>-i &quot;%04d.jpg&quot;</code> The input pattern. This represents a 4-digit zero-padded number with .jpg at the end.</p><p>From manpages (<code>man ffmpeg</code>):</p><blockquote><p>The syntax &ldquo;foo-%03d.jpeg&rdquo; specifies to use a decimal number composed of three digits padded with zeroes to express the sequence number. It is the same syntax supported by the C printf function, but only formats accepting a normal integer are suitable.</p><p>When importing an image sequence, -i also supports expanding shell-like wildcard patterns (globbing) internally, by selecting the image2-specific &ldquo;-pattern_type glob&rdquo; option.</p></blockquote><p><code>-aspect 3024:4032</code> Without this, I was getting a slightly squashed video. This was my photo resolution (in portrait). It happens to be 3:4 but who’s counting anyway.</p><p><code>-vf &quot;transpose=1&quot;</code> This is required to rotate the video 90°. I suppose ffmpeg is not reading EXIF data on the image to get the rotation right on it’s own. No sweat.</p><p><code>-r 8</code> This is the frame rate of the output video. It is a video after all. I set it to match the input frame rate. Any more than that would have no effect.</p><p><code>-vcodec libx264 -profile:v main -level 3.1 -preset medium -crf 23 -x264-params ref=4 -acodec copy -movflags +faststart</code> This is all specific to the video codec used. This configuration works well for most devices.</p><p>And finally, my output file is called <code>out3.mov</code></p></div><footer></footer></article></section></div><footer class=footer><section class=container>© 2020</section></footer></main><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-54181600-1','auto');ga('send','pageview');}</script></body></html>